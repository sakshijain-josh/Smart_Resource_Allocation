openapi: 3.0.3
info:
  title: Resource Allocation API
  description: |
    API for managing resources, bookings, and users in the Resource Allocator application.

    ### Authentication
    This API uses JWT (JSON Web Tokens) for authentication.
    1. Login via `/auth/login` to obtain a token.
    2. Include the token in the `Authorization` header of subsequent requests:
       `Authorization: Bearer <your_token>`
  version: 1.0.0
servers:
  - url: http://localhost:3000/api/v1
    description: Local development server

components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT

  schemas:
    User:
      type: object
      properties:
        id:
          type: string
          format: uuid
          example: "f1234567-89ab-cdef-0123-456789abcdef"
        employee_id:
          type: string
          example: "EMP001"
        name:
          type: string
          example: "John Doe"
        email:
          type: string
          format: email
          example: "john.doe@example.com"
        role:
          type: string
          enum: [admin, employee]
          example: "employee"

    LoginRequest:
      type: object
      properties:
        email:
          type: string
          format: email
          example: "admin@josh.com"
        password:
          type: string
          format: password
          example: "admin123456"
      required:
        - email
        - password

    RegisterUserRequest:
      type: object
      required:
        - user
      properties:
        user:
          type: object
          required:
            - employee_id
            - name
            - email
            - password
            - role
          properties:
            employee_id:
              type: string
              example: "EMP003"
            name:
              type: string
              example: "New User"
            email:
              type: string
              format: email
              example: "newuser@example.com"
            password:
              type: string
              format: password
              example: "password123"
            role:
              type: string
              enum: [admin, employee]
              example: "employee"

    AuthResponse:
      type: object
      properties:
        token:
          type: string
          example: "eyJhbGciOiJIUzI1NiJ9..."
        user:
          $ref: "#/components/schemas/User"
        expires_at:
          type: string
          format: date-time
          example: "2026-02-03T15:00:00Z"

    ErrorResponse:
      type: object
      properties:
        error:
          type: string
          example: "Unauthorized"
        message:
          type: string
          example: "You need to sign in to access this resource"

    ValidationErrorResponse:
      type: object
      properties:
        error:
          type: string
          example: "Validation failed"
        messages:
          type: array
          items:
            type: string
          example: ["Email is already taken", "Password is too short"]

paths:
  /auth/login:
    post:
      summary: Login to get JWT token
      tags:
        - Authentication
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/LoginRequest"
      responses:
        "200":
          description: Successful login
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/AuthResponse"
        "401":
          description: Invalid credentials
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"

  /auth/logout:
    delete:
      summary: Logout and revoke JWT token
      tags:
        - Authentication
      security:
        - bearerAuth: []
      responses:
        "200":
          description: Successfully logged out
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Logged out successfully"
        "401":
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"

  /auth/me:
    get:
      summary: Get current user profile
      tags:
        - Profile
      security:
        - bearerAuth: []
      responses:
        "200":
          description: Current user profile
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/User"
        "401":
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"

  /users:
    post:
      summary: Register a new user (Admin only)
      tags:
        - User Management
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/RegisterUserRequest"
      responses:
        "201":
          description: User created successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "User created successfully"
                  user:
                    $ref: "#/components/schemas/User"
        "403":
          description: Forbidden (Not an admin)
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "422":
          description: Validation failed
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ValidationErrorResponse"
